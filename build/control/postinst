#!/bin/sh

ARCHIVCZSK='/usr/lib/enigma2/python/Plugins/Extensions/archivCZSK'
TMP='/tmp/archivczsk'

check_py ()
{
	if [ -e ${1}o -o -e ${1} ]; then
		echo '0'
	else
		echo '1'
	fi
}

install_py ()
{
	if [ "$(check_py $2)" == '1' ] ; then
		echo "Installing $1 ..."
		cp $1 $2
	fi
}

chmod 755 $ARCHIVCZSK/script/*.sh 2>/dev/null

echo 'Installing neccessary Python libraries'
if [ -d /usr/lib/python2.6 ] ; then
	echo "Found Python 2.6"
	cd  $TMP/python2.6
	install_py ./utf_8.py /usr/lib/python2.6/encodings/utf_8.py
	install_py ./cp1251.py /usr/lib/python2.6/encodings/cp1251.py
	install_py ./cp1252.py /usr/lib/python2.6/encodings/cp1252.py
	install_py ./cp1253.py /usr/lib/python2.6/encodings/cp1253.py
	install_py ./cp1254.py /usr/lib/python2.6/encodings/cp1254.py
	install_py ./cp1256.py /usr/lib/python2.6/encodings/cp1256.py
	install_py ./iso8859_6.py /usr/lib/python2.6/encodings/iso8859_6.py
	install_py ./iso8859_7.py /usr/lib/python2.6/encodings/iso8859_7.py
	install_py ./iso8859_9.py /usr/lib/python2.6/encodings/iso8859_9.py
	install_py ./iso8859_15.py /usr/lib/python2.6/encodings/iso8859_15.py
	install_py ./hex_codec.py /usr/lib/python2.6/encodings/hex_codec.py
	install_py ./latin_1.py /usr/lib/python2.6/encodings/latin_1.py
	install_py ./utf_16.py /usr/lib/python2.6/encodings/utf_16.py
	install_py ./string_escape.py /usr/lib/python2.6/encodings/string_escape.py
	install_py ./idna.py /usr/lib/python2.6/encodings/idna.py
	install_py ./iso8859_2.py /usr/lib/python2.6/encodings/iso8859_2.py
	install_py ./cp1250.py /usr/lib/python2.6/encodings/cp1250.py
	install_py ./decimal.py /usr/lib/python2.6/decimal.py
	install_py ./formatter.py /usr/lib/python2.6/formatter.py
	install_py ./htmlentitydefs.py /usr/lib/python2.6/htmlentitydefs.py
	install_py ./markupbase.py /usr/lib/python2.6/markupbase.py
	install_py ./htmlentitydefs.py /usr/lib/python2.6/htmlentitydefs.py
	install_py ./htmllib.py /usr/lib/python2.6/htmllib.py
	install_py ./markupbase.py /usr/lib/python2.6/markupbase.py
	install_py ./sgmllib.py /usr/lib/python2.6/sgmllib.py
	install_py ./stringprep.py /usr/lib/python2.6/stringprep.py
	install_py ./subprocess.py /usr/lib/python2.6/subprocess.py
	install_py ./numbers.py /usr/lib/python2.6/numbers.py
	install_py ./_LWPCookieJar.py /usr/lib/python2.6/_LWPCookieJar.py
	install_py ./_MozillaCookieJar.py /usr/lib/python2.6/_MozillaCookieJar.py
	install_py ./cookielib.py /usr/lib/python2.6/cookielib.py
	install_py ./shutil.py /usr/lib/python2.6/shutil.py
	install_py ./fnmatch.py /usr/lib/python2.6/fnmatch.py
	install_py ./threading.py /usr/lib/python2.6/threading.py
	install_py ./zipfile.py /usr/lib/python2.6/zipfile.py
	install_py ./stat.py /usr/lib/python2.6/stat.py
	install_py ./httplib.py /usr/lib/python2.6/httplib.py
fi

if [ -d /usr/lib/python2.7 ] ; then
	echo "Found Python 2.7"
	cd $TMP/python2.7
	install_py ./utf_8.py /usr/lib/python2.7/encodings/utf_8.py
	install_py ./cp1251.py /usr/lib/python2.7/encodings/cp1251.py
	install_py ./cp1252.py /usr/lib/python2.7/encodings/cp1252.py
	install_py ./cp1253.py /usr/lib/python2.7/encodings/cp1253.py
	install_py ./cp1254.py /usr/lib/python2.7/encodings/cp1254.py
	install_py ./cp1256.py /usr/lib/python2.7/encodings/cp1256.py
	install_py ./iso8859_6.py /usr/lib/python2.7/encodings/iso8859_6.py
	install_py ./iso8859_7.py /usr/lib/python2.7/encodings/iso8859_7.py
	install_py ./iso8859_9.py /usr/lib/python2.7/encodings/iso8859_9.py
	install_py ./iso8859_15.py /usr/lib/python2.7/encodings/iso8859_15.py
	install_py ./hex_codec.py /usr/lib/python2.7/encodings/hex_codec.py
	install_py ./latin_1.py /usr/lib/python2.7/encodings/latin_1.py
	install_py ./utf_16.py /usr/lib/python2.7/encodings/utf_16.py
	install_py ./iso8859_2.py /usr/lib/python2.7/encodings/iso8859_2.py
	install_py ./cp1250.py /usr/lib/python2.7/encodings/cp1250.py
	install_py ./string_escape.py /usr/lib/python2.7/encodings/string_escape.py
	install_py ./idna.py /usr/lib/python2.7/encodings/idna.py
	install_py ./decimal.py /usr/lib/python2.7/decimal.py
	install_py ./formatter.py /usr/lib/python2.7/formatter.py
	install_py ./htmlentitydefs.py /usr/lib/python2.7/htmlentitydefs.py
	install_py ./htmllib.py /usr/lib/python2.7/htmllib.py
	install_py ./HTMLParser.py /usr/lib/python2.7/HTMLParser.py
	install_py ./markupbase.py /usr/lib/python2.7/markupbase.py
	install_py ./stringprep.py /usr/lib/python2.7/stringprep.py
	install_py ./sgmllib.py /usr/lib/python2.7/sgmllib.py
	install_py ./subprocess.py /usr/lib/python2.7/subprocess.py
	install_py ./numbers.py /usr/lib/python2.7/numbers.py
	install_py ./fnmatch.py /usr/lib/python2.7/fnmatch.py
	install_py ./_LWPCookieJar.py /usr/lib/python2.7/_LWPCookieJar.py
	install_py ./_MozillaCookieJar.py /usr/lib/python2.7/_MozillaCookieJar.py
	install_py ./cookielib.py /usr/lib/python2.7/cookielib.py
	install_py ./shutil.py /usr/lib/python2.7/shutil.py
	install_py ./threading.py /usr/lib/python2.7/threading.py
	install_py ./zipfile.py /usr/lib/python2.7/zipfile.py
	install_py ./stat.py /usr/lib/python2.7/stat.py
	install_py ./httplib.py /usr/lib/python2.7/httplib.py
fi

if [ -f $TMP/categories.xml ] ; then
	echo "Found categories.xml, restoring..."
	cp $TMP/categories.xml $ARCHIVCZSK
fi

if [ -d $TMP/data/ ] ; then
	echo "Found DATA, restoring..."
	if [ -d $ARCHIVCZSK/resources/data ]; then
		rm -rf $ARCHIVCZSK/resources/data
	fi
	cp -R $TMP/data $ARCHIVCZSK/resources
fi

if [ -d $TMP/skins/ ] ; then
	echo "Found SKINS, restoring..."
	cp $TMP/skins/* $ARCHIVCZSK/gui/skins
fi

if [ -d $TMP/addons/ ] ; then
	echo "Found official ADDONS, restoring..."
	# remove saved addon.xml file, so it can be updated
	rm -f $TMP/addons/addon.xml
	
	cp -R $TMP/addons $ARCHIVCZSK/resources/repositories
fi

if [ -d $TMP/repositories/ ] ; then
	find $TMP/repositories -type d -maxdepth 1 -mindepth 1 | while read REPO ; do
		echo "restoring REPOSITORY `basename $REPO` ..."
		cp -R $REPO $ARCHIVCZSK/resources/repositories
	done
fi

echo "Removing temp folder..."
rm -rf $TMP

echo "Installation of archivCZSK was successfull"

exit 0
